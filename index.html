<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Advice Request Form - SOA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
:root {
    --primary: #2c3e50;
    --secondary: #3498db;
    --accent: #1abc9c;
    --light: #ecf0f1;
    --danger: #e74c3c;
    --success: #2ecc71;
    --dark: #34495e;
    --text: #2c3e50;
    --border-radius: 8px;
    --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #f5f7fa;
    color: var(--text);
    line-height: 1.6;
    padding: 20px;
}

.header-controls {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    gap: 10px;
    align-items: center;
}

.save-status {
    background: var(--success);
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
    display: none;
}

.save-status.saving {
    background: var(--secondary);
    display: block;
}

.save-status.saved {
    background: var(--success);
    display: block;
}

.saved-arfs-dropdown {
    position: relative;
}

.saved-arfs-dropdown select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    background: white;
    font-size: 14px;
    min-width: 200px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 30px;
    position: relative;
    margin-top: 60px;
}

h1 {
    color: var(--primary);
    text-align: center;
    margin-bottom: 30px;
    font-weight: 600;
    position: relative;
    padding-bottom: 15px;
}

h1:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 4px;
    background: var(--accent);
    border-radius: 2px;
}

h2 {
    color: var(--secondary);
    margin: 25px 0 15px;
    font-weight: 500;
    font-size: 1.4rem;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--light);
}

h2 i {
    margin-right: 10px;
}

h3 {
    margin-top: 20px;
    margin-bottom: 10px;
    color: var(--dark);
}

h4 {
    margin-top: 15px;
    margin-bottom: 10px;
    color: var(--dark);
    font-size: 1.1rem;
}

.section {
    margin-bottom: 30px;
    padding: 20px;
    border-radius: var(--border-radius);
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border-left: 4px solid var(--accent);
    opacity: 1;
    height: auto;
    overflow: hidden;
    transition: var(--transition);
    page-break-inside: avoid;
}

.section.hidden {
    opacity: 0;
    height: 0;
    padding: 0;
    margin: 0;
    overflow: hidden;
}

.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--dark);
}

input[type="text"],
input[type="date"],
input[type="number"],
textarea,
select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    font-size: 16px;
    transition: var(--transition);
    background: var(--light);
}

input[type="text"]:focus,
input[type="date"]:focus,
input[type="number"]:focus,
textarea:focus,
select:focus {
    border-color: var(--secondary);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    outline: none;
}

textarea {
    min-height: 100px;
    resize: vertical;
    font-family: inherit;
    line-height: 1.5;
}

.btn {
    display: inline-block;
    background: var(--secondary);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: var(--transition);
    text-align: center;
    text-decoration: none;
}

.btn:hover {
    background: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn-success {
    background: var(--success);
}

.btn-danger {
    background: var(--danger);
}

.btn-primary {
    background: var(--primary);
}

.btn-sm {
    padding: 6px 12px;
    font-size: 14px;
}

.btn-icon {
    padding: 8px 12px;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.btn-group {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    justify-content: center;
    flex-wrap: wrap;
}

.radio-group {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.radio-item {
    display: flex;
    align-items: center;
    background: var(--light);
    border-radius: var(--border-radius);
    padding: 10px 15px;
    cursor: pointer;
    transition: var(--transition);
}

.radio-item:hover {
    background: rgba(52, 152, 219, 0.1);
}

.radio-item input[type="radio"] {
    margin-right: 10px;
}

.radio-item label {
    display: flex;
    align-items: center;
    margin-bottom: 0;
    cursor: pointer;
}

.radio-item label i {
    margin-right: 8px;
    font-size: 18px;
    color: var(--secondary);
}

.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.checkbox-group.client-types {
    justify-content: flex-start;
    max-width: 600px;
}

.checkbox-group.entity-types {
    justify-content: flex-start;
}

.checkbox-item {
    display: flex;
    align-items: center;
    background: var(--light);
    padding: 10px 15px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
    border: 2px solid transparent;
    flex: 0 0 auto;
}

.checkbox-item:hover {
    background: rgba(52, 152, 219, 0.1);
}

.checkbox-item.selected {
    border-color: var(--accent);
    background-color: rgba(26, 188, 156, 0.1);
}

.checkbox-item input[type="checkbox"] {
    margin-right: 8px;
}

.checkbox-item label {
    display: flex;
    align-items: center;
    margin-bottom: 0;
    cursor: pointer;
}

.checkbox-item label i {
    margin-right: 8px;
    font-size: 18px;
    color: var(--secondary);
}

.grid-2 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

@media (max-width: 768px) {
    .grid-3 {
        grid-template-columns: 1fr;
    }
}

.grid-3-custom {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    align-items: end;
}

.note {
    background-color: rgba(52, 152, 219, 0.1);
    border-left: 4px solid var(--secondary);
    padding: 15px;
    border-radius: var(--border-radius);
    margin: 20px 0;
}

.note p {
    margin: 0;
}

.checklist-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 10px;
    background-color: var(--light);
    border-radius: var(--border-radius);
    page-break-inside: avoid;
}

.checklist-item label {
    margin-bottom: 0;
    margin-left: 10px;
    cursor: pointer;
}

.sub-checklist {
    margin-left: 30px;
    margin-top: 10px;
    padding: 10px;
    background-color: rgba(52, 152, 219, 0.05);
    border-radius: var(--border-radius);
}

@media print {
    body {
        background: white;
        padding: 0;
    }
    
    .container {
        box-shadow: none;
        max-width: 100%;
        padding: 20px;
    }
    
    .btn-group, .no-print, .header-controls {
        display: none !important;
    }
    
    .section {
        page-break-inside: avoid;
        box-shadow: none;
        border-left: 2px solid var(--accent);
    }
    
    input, textarea, select {
        border: 1px solid #ddd !important;
        background: white !important;
    }
}

@media (max-width: 768px) {
    .grid-2 {
        grid-template-columns: 1fr;
    }
    
    .grid-3 {
        grid-template-columns: 1fr;
    }
    
    .checkbox-group.client-types {
        flex-direction: column;
        max-width: none;
    }
    
    .radio-group {
        flex-direction: column;
    }
    
    .header-controls {
        position: relative;
        top: auto;
        right: auto;
        margin-bottom: 20px;
        justify-content: center;
    }
    
    .container {
        margin-top: 20px;
    }
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--success);
}

input:focus + .slider {
    box-shadow: 0 0 1px var(--success);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.yes-no-label {
    display: flex;
    align-items: center;
    justify-content: flex-start;
}

.yes-no-label label:first-child {
    margin-right: 15px;
}

.yes-no-label span {
    margin-left: 10px;
}

.entity-selector {
    margin-top: 20px;
    display: none;
}

.entity-selector.show {
    display: block;
}

.product-recommendations {
    background-color: rgba(26, 188, 156, 0.05);
    padding: 15px;
    border-radius: var(--border-radius);
    margin-top: 15px;
    page-break-inside: avoid;
}

.product-item {
    background-color: white;
    padding: 15px;
    border-radius: var(--border-radius);
    margin-bottom: 15px;
    border: 1px solid #e0e0e0;
    page-break-inside: avoid;
}

.product-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.add-product-btn {
    margin-top: 10px;
}

.risk-profile-section {
    background-color: rgba(52, 152, 219, 0.05);
    padding: 15px;
    border-radius: var(--border-radius);
    margin-top: 15px;
    page-break-inside: avoid;
}

.inline-checkbox {
    display: inline-flex;
    align-items: center;
    margin-left: 15px;
}

.inline-checkbox input {
    margin-right: 5px;
}

.searchable-select {
    position: relative;
}

.searchable-select input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    font-size: 16px;
    background: var(--light);
}

.dropdown-list {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    max-height: 300px;
    overflow-y: auto;
    background: white;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 var(--border-radius) var(--border-radius);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    display: none;
}

.dropdown-list.active {
    display: block;
}

.dropdown-item {
    padding: 10px 15px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.dropdown-item:hover {
    background-color: var(--light);
}

.dropdown-item.selected {
    background-color: var(--secondary);
    color: white;
}

.tranching-details {
    margin-top: 10px;
    padding: 10px;
    background-color: rgba(52, 152, 219, 0.05);
    border-radius: var(--border-radius);
}

.mda-section {
    margin-top: 15px;
    padding: 10px;
    background-color: rgba(46, 204, 113, 0.05);
    border-radius: var(--border-radius);
}

.custom-input {
    margin-top: 0;
}

.save-dialog {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.save-dialog-content {
    background: white;
    padding: 30px;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    max-width: 400px;
    width: 90%;
}

.save-dialog h3 {
    margin-bottom: 20px;
    color: var(--primary);
}

.save-dialog input {
    width: 100%;
    margin-bottom: 20px;
}

.save-dialog-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.word-export {
    font-family: 'Calibri', 'Arial', sans-serif;
    line-height: 1.5;
    color: #000;
}

.word-export h1 {
    font-size: 24pt;
    margin-bottom: 20pt;
}

.word-export h2 {
    font-size: 18pt;
    margin-top: 20pt;
    margin-bottom: 10pt;
}

.word-export h3 {
    font-size: 14pt;
    margin-top: 15pt;
    margin-bottom: 10pt;
}

.word-export .section {
    margin-bottom: 20pt;
    padding: 15pt;
}
    </style>
</head>
<body>
    <!-- Header Controls -->
    <div class="header-controls">
        <div class="save-status" id="saveStatus">Saving...</div>
        <div class="saved-arfs-dropdown">
            <select id="savedArfsSelect">
                <option value="">Load Saved ARF...</option>
            </select>
        </div>
    </div>

    <!-- Save Dialog -->
    <div class="save-dialog" id="saveDialog">
        <div class="save-dialog-content">
            <h3>Save ARF</h3>
            <input type="text" id="saveNameInput" placeholder="Enter ARF name..." maxlength="50">
            <div class="save-dialog-buttons">
                <button class="btn" id="cancelSaveBtn">Cancel</button>
                <button class="btn btn-success" id="confirmSaveBtn">Save</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>Statement of Advice Request Form</h1>
        
        <!-- Client Type Section -->
        <section class="section" id="clientTypeSection">
            <h2><i class="fas fa-user-circle"></i> Client Details</h2>
            
            <!-- New/Existing Client Selector -->
            <div class="form-group">
                <label>Client Status:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="newClient" name="clientStatus" value="new">
                        <label for="newClient">
                            <i class="fas fa-plus-circle"></i>
                            New Client
                        </label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="existingClient" name="clientStatus" value="existing">
                        <label for="existingClient">
                            <i class="fas fa-user-check"></i>
                            Existing Client
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Client Type Selector -->
            <div class="form-group">
                <label>Select Client Type (multiple selections allowed):</label>
                <div class="checkbox-group client-types">
                    <div class="checkbox-item">
                        <input type="checkbox" id="singleClient" name="clientType" value="single">
                        <label for="singleClient">
                            <i class="fas fa-user"></i>
                            Single Client
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="coupleClient" name="clientType" value="couple">
                        <label for="coupleClient">
                            <i class="fas fa-users"></i>
                            Couple
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="dependantsClient" name="clientType" value="dependants">
                        <label for="dependantsClient">
                            <i class="fas fa-child"></i>
                            Dependants
                        </label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="entityClient" name="clientType" value="entity">
                        <label for="entityClient">
                            <i class="fas fa-building"></i>
                            Entity
                        </label>
                    </div>
                </div>
                
                <!-- Entity Type Selector (shows only when entity is selected) -->
                <div class="entity-selector" id="entitySelector">
                    <label>Select Entity Type:</label>
                    <div class="checkbox-group entity-types">
                        <div class="checkbox-item">
                            <input type="checkbox" id="entitySMSF" name="entityType" value="SMSF">
                            <label for="entitySMSF">SMSF</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="entityTrust" name="entityType" value="Trust">
                            <label for="entityTrust">Trust</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="entityCompany" name="entityType" value="Company">
                            <label for="entityCompany">Company</label>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Strategy Details Section -->
        <section class="section" id="strategyDetailsSection">
            <h2><i class="fas fa-info-circle"></i> Strategy Details</h2>
            
            <div class="grid-2">
                <div class="form-group" id="clientNameGroup">
                    <label for="clientName">Client 1 Name:</label>
                    <input type="text" id="clientName" name="clientName" placeholder="Enter client name">
                </div>
                
                <div class="form-group" id="partnerNameGroup" style="display: none;">
                    <label for="partnerName">Client 2 Name (Spouse):</label>
                    <input type="text" id="partnerName" name="partnerName" placeholder="Enter partner name">
                </div>
            </div>
            
            <div class="form-group" id="entityNameGroup" style="display: none;">
                <label for="entityName">Entity Name:</label>
                <input type="text" id="entityName" name="entityName" placeholder="Enter entity name">
            </div>
            
            <div class="grid-2">
                <div class="form-group">
                    <label for="xplanId">Xplan ID (if applicable):</label>
                    <input type="text" id="xplanId" name="xplanId" placeholder="Enter Xplan ID">
                </div>
                
                <div class="form-group">
                    <label for="adviserName">Adviser Name:</label>
                    <input type="text" id="adviserName" name="adviserName" placeholder="Enter adviser name">
                </div>
            </div>
            
            <div class="grid-2">
                <div class="form-group">
                    <label for="clientMeetingDate">Client Meeting Date:</label>
                    <input type="date" id="clientMeetingDate" name="clientMeetingDate">
                </div>
                
                <div class="form-group">
                    <label for="formCompletedBy">Form Completed by:</label>
                    <input type="text" id="formCompletedBy" name="formCompletedBy" placeholder="Enter your name">
                </div>
            </div>
        </section>
        
        <!-- Strategy Recommendations Section -->
        <section class="section" id="strategyRecommendationsSection">
            <h2><i class="fas fa-lightbulb"></i> Strategy Recommendations</h2>
            
            <div id="recommendationsSectionsContainer">
                <!-- Dynamic recommendation sections will be added here -->
            </div>
            
            <div class="form-group">
                <label for="goalAlignment">How strategy aligns to goals and objectives?</label>
                <textarea id="goalAlignment" name="goalAlignment" placeholder="Explain how the strategy aligns with client goals and objectives"></textarea>
            </div>
            
            <div class="form-group">
                <label for="mdaDetails">MDA Personalisation:</label>
                <textarea id="mdaDetails" name="mdaDetails" placeholder="Enter MDA personalisation details"></textarea>
            </div>
            
            <div class="form-group">
                <label for="tmdDetails">TMD:</label>
                <textarea id="tmdDetails" name="tmdDetails" placeholder="Enter TMD details"></textarea>
            </div>
            
            <div class="form-group">
                <label for="inaccurateInfo">Any potentially inaccurate or incomplete information:</label>
                <textarea id="inaccurateInfo" name="inaccurateInfo" placeholder="Include reasons why information may be inaccurate or was not provided"></textarea>
            </div>
            
            <div class="form-group">
                <label for="alternativeStrategies">Alternatives - strategies:</label>
                <textarea id="alternativeStrategies" name="alternativeStrategies" placeholder="Enter alternative strategies"></textarea>
            </div>
            
            <div class="form-group">
                <label for="alternativePlatforms">
                    Alternatives - platforms:
                    <span class="inline-checkbox">
                        <input type="checkbox" id="paraplannerCompare" name="paraplannerCompare">
                        <label for="paraplannerCompare">Paraplanner to complete compare</label>
                    </span>
                </label>
                <textarea id="alternativePlatforms" name="alternativePlatforms" placeholder="Enter alternative platforms"></textarea>
            </div>
        </section>
        
        <!-- Flowchart Section -->
        <section class="section" id="flowchartSection">
            <h2><i class="fas fa-project-diagram"></i> Flowchart</h2>
            
            <div class="form-group">
                <div class="yes-no-label">
                    <label for="flowchartRequired">Flowchart required?</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="flowchartRequired" name="flowchartRequired">
                        <span class="slider"></span>
                    </label>
                    <span id="flowchartStatus">No</span>
                </div>
            </div>
        </section>
        
        <!-- SOA Projections Section -->
        <section class="section" id="soaProjectionsSection">
            <h2><i class="fas fa-chart-line"></i> SOA Projections</h2>
            
            <div class="form-group">
                <label for="projectionDateLength">Projection date length:</label>
                <select id="projectionDateLength" name="projectionDateLength">
                    <option value="lifeExpectancy">Life Expectancy (default)</option>
                    <option value="lifeExpectancy5">Life Expectancy + 5 years</option>
                    <option value="lifeExpectancy10">Life Expectancy + 10 years</option>
                    <option value="5">5 years</option>
                    <option value="10">10 years</option>
                    <option value="15">15 years</option>
                    <option value="20">20 years</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group" id="otherProjectionLength" style="display: none;">
                <label for="otherProjectionLengthValue">Specify other projection length:</label>
                <input type="number" id="otherProjectionLengthValue" name="otherProjectionLengthValue" placeholder="Enter number of years">
            </div>
            
            <div class="form-group">
                <div class="checklist-item">
                    <input type="checkbox" id="calmChart" name="projectionOptions" value="CALM">
                    <label for="calmChart">CALM to chart, cashflow consolidated table, asset summary chart and table</label>
                </div>
                
                <div class="checklist-item">
                    <input type="checkbox" id="contributionsTable" name="projectionOptions" value="Contributions">
                    <label for="contributionsTable">If contributions advice is relevant, we need a before and after tax table Year 1</label>
                </div>
                
                <div class="checklist-item">
                    <input type="checkbox" id="pensionTable" name="projectionOptions" value="Pension">
                    <label for="pensionTable">If aged pension advice is relevant we need a before and after aged pension table Year 1</label>
                </div>
                
                <div class="checklist-item">
                    <input type="checkbox" id="insuranceProjection" name="projectionOptions" value="Insurance">
                    <label for="insuranceProjection">If insurance advice is relevant we need insurance premiums 10 years with premiums indexed at 10%</label>
                </div>
            </div>
        </section>
        
        <!-- SOA Fees Section -->
        <section class="section" id="soaFeesSection">
            <h2><i class="fas fa-dollar-sign"></i> SOA Fees</h2>
            
            <div class="grid-2">
                <div class="form-group">
                    <label for="upfrontFee">Upfront Fee (including GST):</label>
                    <input type="text" id="upfrontFee" name="upfrontFee" placeholder="Enter upfront fee">
                </div>
                
                <div class="form-group">
                    <label for="paymentMethod">Method of payment:</label>
                    <input type="text" id="paymentMethod" name="paymentMethod" placeholder="Enter payment method">
                </div>
            </div>
            
            <div class="grid-2">
                <div class="form-group">
                    <label for="implementationFee">Implementation fee:</label>
                    <input type="text" id="implementationFee" name="implementationFee" placeholder="Enter implementation fee">
                </div>
                
                <div class="form-group">
                    <label for="ongoingFee">Ongoing Fee (including GST):</label>
                    <input type="text" id="ongoingFee" name="ongoingFee" placeholder="Refer to pricing calculator">
                </div>
            </div>
            
            <div id="dynamicFeesContainer">
                <!-- Dynamic fees will be added here based on entity selections -->
            </div>
            
            <div class="form-group">
                <label for="referralFee">Referral Fee Applicable:</label>
                <input type="text" id="referralFee" name="referralFee" placeholder="Enter referral fee or N/A">
            </div>
        </section>
        
        <!-- Additional Comments Section -->
        <section class="section" id="additionalCommentsSection">
            <h2><i class="fas fa-comment-alt"></i> Additional Comments/Notes</h2>
            
            <div class="form-group">
                <textarea id="additionalComments" name="additionalComments" placeholder="Enter any additional comments or notes"></textarea>
            </div>
        </section>
        
        <!-- Compliance Checklist Section -->
        <section class="section" id="checklistSection">
            <h2><i class="fas fa-tasks"></i> Compliance Checklist</h2>
            
            <div class="note">
                <p>Please ensure the required documents and approvals are obtained and uploaded prior to submitting your request to the paraplanning team.</p>
            </div>
            
            <h3>All Advice documents</h3>
            <div class="form-group">
                <div class="checklist-item">
                    <input type="checkbox" id="factFind" name="requiredDocs" value="FactFind">
                    <label for="factFind">Fact Find (dated within 12 months)</label>
                </div>
                
                <div class="checklist-item">
                    <input type="checkbox" id="filenote" name="requiredDocs" value="Filenote">
                    <label for="filenote">Filenote</label>
                </div>
                
                <div class="checklist-item">
                    <input type="checkbox" id="pricingCalculator" name="requiredDocs" value="PricingCalculator">
                    <label for="pricingCalculator">Pricing Calculator</label>
                </div>
                
                <div class="checklist-item">
                    <input type="checkbox" id="beneficiaryNomination" name="compliance" value="BeneficiaryNomination">
                    <label for="beneficiaryNomination">Beneficiary nomination advice made (if relevant)</label>
                </div>
            </div>
            
            <h3>Compliance Requirements</h3>
            <div id="complianceRequirements">
                <!-- Dynamic compliance requirements will be added here -->
            </div>
        </section>
        
        <!-- Button Group -->
        <div class="btn-group">
            <button type="button" class="btn" id="saveBtn">Save As</button>
            <button type="button" class="btn btn-success" id="exportWordBtn">Export to Word</button>
            <button type="button" class="btn btn-success" id="exportPdfBtn">Export to PDF</button>
            <button type="button" class="btn btn-primary" id="saveToXplanBtnBottom">
                <i class="fas fa-save"></i> Save to Xplan
            </button>
            <button type="button" class="btn btn-primary" id="emailDocumentBtnBottom">
                <i class="fas fa-envelope"></i> Email Document
            </button>
            <button type="button" class="btn btn-danger" id="resetBtn">Reset Form</button>
        </div>
    </div>

    <script>
console.log('Script starting...');

// Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing...');
    
    // Global variables
    let hasUnsavedChanges = false;
    let autoSaveInterval;
    let currentSaveName = '';
    
    // Get all button elements first and log them
    const saveBtn = document.getElementById('saveBtn');
    const exportWordBtn = document.getElementById('exportWordBtn');
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    const resetBtn = document.getElementById('resetBtn');
    const saveToXplanBtnBottom = document.getElementById('saveToXplanBtnBottom');
    const emailDocumentBtnBottom = document.getElementById('emailDocumentBtnBottom');
    
    console.log('Buttons found:', {
        saveBtn: !!saveBtn,
        exportWordBtn: !!exportWordBtn,
        exportPdfBtn: !!exportPdfBtn,
        resetBtn: !!resetBtn,
        saveToXplanBtnBottom: !!saveToXplanBtnBottom,
        emailDocumentBtnBottom: !!emailDocumentBtnBottom
    });
    
    // Save system elements
    const saveDialog = document.getElementById('saveDialog');
    const saveNameInput = document.getElementById('saveNameInput');
    const confirmSaveBtn = document.getElementById('confirmSaveBtn');
    const cancelSaveBtn = document.getElementById('cancelSaveBtn');
    const savedArfsSelect = document.getElementById('savedArfsSelect');
    const saveStatus = document.getElementById('saveStatus');
    
    // Initialize
    startAutoSave();
    loadSavedArfsDropdown();
    
    // Button event listeners with console logs
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            console.log('Save button clicked');
            saveDialog.style.display = 'flex';
            saveNameInput.value = currentSaveName || '';
            saveNameInput.focus();
        });
    }
    
    if (exportWordBtn) {
        exportWordBtn.addEventListener('click', function() {
            console.log('Export Word button clicked');
            exportToWord();
        });
    }
    
    if (exportPdfBtn) {
        exportPdfBtn.addEventListener('click', function() {
            console.log('Export PDF button clicked');
            exportToPDF();
        });
    }
    
    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            console.log('Reset button clicked');
            resetForm();
        });
    }
    
    if (saveToXplanBtnBottom) {
        saveToXplanBtnBottom.addEventListener('click', function() {
            console.log('Save to Xplan button clicked');
            alert('This functionality is coming soon.');
        });
    }
    
    if (emailDocumentBtnBottom) {
        emailDocumentBtnBottom.addEventListener('click', function() {
            console.log('Email document button clicked');
            emailDocument();
        });
    }
    
    // Save dialog handlers
    if (confirmSaveBtn) {
        confirmSaveBtn.addEventListener('click', function() {
            const name = saveNameInput.value.trim();
            if (name) {
                saveFormData(name);
                saveDialog.style.display = 'none';
            } else {
                alert('Please enter a name for the ARF');
            }
        });
    }
    
    if (cancelSaveBtn) {
        cancelSaveBtn.addEventListener('click', function() {
            saveDialog.style.display = 'none';
        });
    }
    
    if (savedArfsSelect) {
        savedArfsSelect.addEventListener('change', function() {
            if (this.value) {
                if (hasUnsavedChanges) {
                    if (confirm('You have unsaved changes. Do you want to continue loading the saved ARF?')) {
                        loadFormData(this.value);
                    } else {
                        this.value = '';
                    }
                } else {
                    loadFormData(this.value);
                }
            }
        });
    }
    
    // Export to Word function
    function exportToWord() {
        console.log('Starting Word export...');
        try {
            const content = getCurrentFormContent();
            const clientName = document.getElementById('clientName').value || 'Client';
            
            const html = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset="utf-8">
                    <title>Financial Advice Request Form - ${clientName}</title>
                    <style>
                        body { font-family: Calibri, Arial, sans-serif; line-height: 1.5; color: #000; margin: 20px; }
                        h1 { font-size: 24pt; text-align: center; color: #2c3e50; margin-bottom: 20pt; }
                        h2 { font-size: 18pt; color: #3498db; margin-top: 20pt; margin-bottom: 10pt; border-bottom: 2px solid #ecf0f1; padding-bottom: 5pt; }
                        h3 { font-size: 14pt; color: #34495e; margin-top: 15pt; margin-bottom: 10pt; }
                        h4 { font-size: 12pt; color: #34495e; margin-top: 10pt; margin-bottom: 8pt; }
                        .section { margin-bottom: 20pt; padding: 15pt; border-left: 4px solid #1abc9c; background-color: #f9f9f9; page-break-inside: avoid; }
                        .form-group { margin-bottom: 15pt; }
                        label { font-weight: bold; display: block; margin-bottom: 5pt; }
                        input, textarea, select { border: 1px solid #ddd; padding: 8pt; width: 100%; margin-bottom: 10pt; font-family: Calibri, Arial, sans-serif; background: white; }
                        textarea { min-height: 60px; vertical-align: top; }
                        .checklist-item { margin-bottom: 8pt; padding: 5pt; background-color: #ecf0f1; }
                        .note { background-color: #e3f2fd; padding: 10pt; margin: 15pt 0; border-left: 4px solid #3498db; }
                        .product-item { border: 1px solid #ddd; padding: 10pt; margin-bottom: 10pt; background-color: #fff; page-break-inside: avoid; }
                        .grid-2 { display: table; width: 100%; }
                        .grid-2 > div { display: table-cell; padding: 5pt; width: 50%; }
                        .checkbox-item { display: inline-block; margin: 5pt; padding: 5pt; background: #f0f0f0; }
                        .radio-item { display: inline-block; margin: 5pt; padding: 5pt; background: #f0f0f0; }
                        .hidden { display: none; }
                        i { display: none; }
                    </style>
                </head>
                <body>
                    ${content.innerHTML}
                </body>
                </html>
            `;
            
            const blob = new Blob([html], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Findex_ARF_${clientName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('Word export completed');
        } catch (error) {
            console.error('Word export error:', error);
            alert('Error exporting to Word. Please try again.');
        }
    }
    
    // Export to PDF function
    function exportToPDF() {
        console.log('Starting PDF export...');
        
        // Check if html2pdf is available
        if (typeof html2pdf === 'undefined') {
            console.error('html2pdf library not loaded');
            alert('PDF export library not loaded. Please refresh the page and try again.');
            return;
        }
        
        try {
            const content = getCurrentFormContent();
            const clientName = document.getElementById('clientName').value || 'Client';
            
            const opt = {
                margin: [15, 15, 15, 15],
                filename: `Findex_ARF_${clientName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    letterRendering: true
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                },
                pagebreak: { 
                    mode: ['avoid-all', 'css', 'legacy'],
                    before: '.section',
                    avoid: ['.product-item', '.checklist-item', '.form-group']
                }
            };
            
            html2pdf().set(opt).from(content).save().then(() => {
                console.log('PDF export completed');
            }).catch(error => {
                console.error('PDF export error:', error);
                alert('Error generating PDF. Please try again.');
            });
            
        } catch (error) {
            console.error('PDF export error:', error);
            alert('Error exporting to PDF. Please try again.');
        }
    }
    
    // Email document function
    function emailDocument() {
        console.log('Starting email document...');
        try {
            const clientName = document.getElementById('clientName').value || 'Client';
            
            const subject = `Findex ARF for ${clientName}`;
            const body = `Hi,

Please find attached the draft Advice Request Form (ARF) for ${clientName} for your review and approval.

This document contains the strategy recommendations and compliance requirements for the client's financial advice needs. Please review the details and let me know if you have any questions or require any modifications.

Thank you for your attention to this matter.

Best regards`;
            
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Try to open email client
            window.location.href = mailtoLink;
            
            // Also generate PDF for attachment
            exportToPDF();
            
            setTimeout(() => {
                alert('Email client opened. A PDF has also been generated for you to attach manually.');
            }, 1000);
            
        } catch (error) {
            console.error('Email error:', error);
            alert('Error opening email client. Please try again.');
        }
    }
    
    // Reset form function
    function resetForm() {
        if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
            document.querySelectorAll('input[type="text"], input[type="date"], input[type="number"], textarea').forEach(field => {
                field.value = '';
            });
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            
            document.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });
            
            document.querySelectorAll('.checkbox-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Reset save state
            currentSaveName = '';
            hasUnsavedChanges = false;
            showSaveStatus('');
            
            alert('Form has been reset!');
        }
    }
    
    // Get current form content for export
    function getCurrentFormContent() {
        const container = document.querySelector('.container').cloneNode(true);
        
        // Remove buttons and controls
        const btnGroup = container.querySelector('.btn-group');
        if (btnGroup) btnGroup.remove();
        
        // Remove hidden sections
        const hiddenSections = container.querySelectorAll('.section.hidden, [style*="display: none"]');
        hiddenSections.forEach(section => section.remove());
        
        return container;
    }
    
    // Auto-save functionality
    function startAutoSave() {
        autoSaveInterval = setInterval(() => {
            if (hasUnsavedChanges) {
                autoSave();
            }
        }, 30000);
        
        document.addEventListener('change', markAsChanged);
        document.addEventListener('input', markAsChanged);
    }
    
    function markAsChanged() {
        hasUnsavedChanges = true;
        showSaveStatus('saving');
    }
    
    function autoSave() {
        if (currentSaveName) {
            saveFormData(currentSaveName, true);
        } else {
            saveFormData('Auto-save Draft', true);
        }
    }
    
    function showSaveStatus(status) {
        if (saveStatus) {
            saveStatus.className = `save-status ${status}`;
            if (status === 'saved') {
                setTimeout(() => {
                    saveStatus.className = 'save-status';
                }, 2000);
            }
        }
    }
    
    function saveFormData(name, isAutoSave = false) {
        try {
            const formData = {};
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.type === 'checkbox' || element.type === 'radio') {
                    formData[element.id] = element.checked;
                } else {
                    formData[element.id] = element.value;
                }
            });
            
            const savedArfs = JSON.parse(localStorage.getItem('savedArfs') || '{}');
            savedArfs[name] = {
                data: formData,
                timestamp: new Date().toISOString(),
                isAutoSave: isAutoSave
            };
            
            localStorage.setItem('savedArfs', JSON.stringify(savedArfs));
            
            if (!isAutoSave) {
                currentSaveName = name;
                hasUnsavedChanges = false;
                loadSavedArfsDropdown();
                showSaveStatus('saved');
            } else {
                showSaveStatus('saved');
            }
        } catch (error) {
            console.error('Save error:', error);
        }
    }
    
    function loadSavedArfsDropdown() {
        if (!savedArfsSelect) return;
        
        try {
            const savedArfs = JSON.parse(localStorage.getItem('savedArfs') || '{}');
            savedArfsSelect.innerHTML = '<option value="">Load Saved ARF...</option>';
            
            Object.keys(savedArfs).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = `${name} (${new Date(savedArfs[name].timestamp).toLocaleDateString()})`;
                savedArfsSelect.appendChild(option);
            });
        } catch (error) {
            console.error('Load dropdown error:', error);
        }
    }
    
    function loadFormData(name) {
        try {
            const savedArfs = JSON.parse(localStorage.getItem('savedArfs') || '{}');
            if (savedArfs[name]) {
                const formData = savedArfs[name].data;
                Object.keys(formData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox' || element.type === 'radio') {
                            element.checked = formData[key];
                            if (element.type === 'checkbox') {
                                const item = element.closest('.checkbox-item');
                                if (item) {
                                    item.classList.toggle('selected', element.checked);
                                }
                            }
                        } else {
                            element.value = formData[key];
                        }
                    }
                });
                currentSaveName = name;
                hasUnsavedChanges = false;
                showSaveStatus('saved');
            }
        } catch (error) {
            console.error('Load form error:', error);
        }
    }
    
    // Warn before leaving
    window.addEventListener('beforeunload', function(e) {
        if (hasUnsavedChanges) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
    
    console.log('Initialization complete!');
});
    </script>
</body>
</html>
